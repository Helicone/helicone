'use client';
import{__rest as e}from"tslib";import{Popover as r,Transition as t,Listbox as a}from"@headlessui/react";import o,{useState as n,useMemo as l}from"react";import d from"../../../assets/CalendarIcon.js";import s from"../../../assets/XCircleIcon.js";import{startOfToday as m,startOfMonth as i}from"date-fns";import{border as u}from"../../../lib/shape.js";import{sizing as c}from"../../../lib/sizing.js";import{spacing as b}from"../../../lib/spacing.js";import{tremorTwMerge as f}from"../../../lib/tremorTwMerge.js";import{getNodeText as p,constructValueToNameMapping as g,getSelectButtonColors as k,hasValue as v}from"../selectUtils.js";import{defaultOptions as h,parseStartDate as w,parseEndDate as x,formatSelectedDates as y,makeDateRangePickerClassName as N}from"./dateRangePickerUtils.js";import E from"../Calendar/Calendar.js";import"../Select/Select.js";import j from"../Select/SelectItem.js";import{enUS as S}from"date-fns/locale";import C from"../../../hooks/useInternalState.js";const X=m(),D=o.forwardRef(((m,D)=>{var F,R;const{value:O,defaultValue:T,onValueChange:V,enableSelect:B=!0,minDate:I,maxDate:_,placeholder:z="Select range",selectPlaceholder:M="Select range",disabled:P=!1,locale:Y=S,enableClear:L=!0,displayFormat:U,children:q,className:A,enableYearNavigation:G=!1,weekStartsOn:H=0,disabledDates:J}=m,K=e(m,["value","defaultValue","onValueChange","enableSelect","minDate","maxDate","placeholder","selectPlaceholder","disabled","locale","enableClear","displayFormat","children","className","enableYearNavigation","weekStartsOn","disabledDates"]),[Q,W]=C(T,O),[Z,$]=n(!1),[ee,re]=n(!1),te=l((()=>{const e=[];return I&&e.push({before:I}),_&&e.push({after:_}),[...e,...null!=J?J:[]]}),[I,_,J]),ae=l((()=>{const e=new Map;return q?o.Children.forEach(q,(r=>{var t;e.set(r.props.value,{text:null!==(t=p(r))&&void 0!==t?t:r.props.value,from:r.props.from,to:r.props.to})})):h.forEach((r=>{e.set(r.value,{text:r.text,from:r.from,to:X})})),e}),[q]),oe=l((()=>{if(q)return g(q);const e=new Map;return h.forEach((r=>e.set(r.value,r.text))),e}),[q]),ne=(null==Q?void 0:Q.selectValue)||"",le=w(null==Q?void 0:Q.from,I,ne,ae),de=x(null==Q?void 0:Q.to,_,ne,ae),se=le||de?y(le,de,Y,U):z,me=i(null!==(R=null!==(F=null!=de?de:le)&&void 0!==F?F:_)&&void 0!==R?R:X),ie=L&&!P;return o.createElement("div",Object.assign({ref:D,className:f("w-full min-w-[10rem] relative flex justify-between text-tremor-default max-w-sm shadow-tremor-input dark:shadow-dark-tremor-input rounded-tremor-default",A)},K),o.createElement(r,{as:"div",className:f("w-full",B?"rounded-l-tremor-default":"rounded-tremor-default",Z&&"ring-2 ring-tremor-brand-muted dark:ring-dark-tremor-brand-muted z-10")},o.createElement("div",{className:"relative w-full"},o.createElement(r.Button,{onFocus:()=>$(!0),onBlur:()=>$(!1),disabled:P,className:f("w-full outline-none text-left whitespace-nowrap truncate focus:ring-2 transition duration-100 rounded-l-tremor-default flex flex-nowrap","rounded-l-tremor-default border-tremor-border text-tremor-content-emphasis focus:border-tremor-brand-subtle focus:ring-tremor-brand-muted","dark:border-dark-tremor-border dark:text-dark-tremor-content-emphasis dark:focus:border-dark-tremor-brand-subtle dark:focus:ring-dark-tremor-brand-muted",B?"rounded-l-tremor-default":"rounded-tremor-default",b.lg.paddingLeft,ie?b.fourXl.paddingRight:b.twoXl.paddingRight,b.sm.paddingY,u.sm.all,k(v(le||de),P))},o.createElement(d,{className:f(N("calendarIcon"),"flex-none shrink-0","text-tremor-content-subtle","dark:text-dark-tremor-content-subtle",c.lg.height,c.lg.width,b.threeXs.negativeMarginLeft,b.sm.marginRight),"aria-hidden":"true"}),o.createElement("p",{className:"truncate"},se)),ie&&le?o.createElement("button",{type:"button",className:f("absolute outline-none inset-y-0 right-0 flex items-center transition duration-100",b.twoXl.marginRight),onClick:e=>{e.preventDefault(),null==V||V({}),W({})}},o.createElement(s,{className:f(N("clearIcon"),"flex-none","text-tremor-content-subtle","dark:text-dark-tremor-content-subtle",c.md.height,c.md.width)})):null),o.createElement(t,{className:"absolute z-10 min-w-min left-0",enter:"transition ease duration-100 transform",enterFrom:"opacity-0 -translate-y-4",enterTo:"opacity-100 translate-y-0",leave:"transition ease duration-100 transform",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 -translate-y-4"},o.createElement(r.Panel,{focus:!0,className:f("divide-y overflow-y-auto outline-none rounded-tremor-default p-3","bg-tremor-background border-tremor-border divide-tremor-border shadow-tremor-dropdown","dark:bg-dark-tremor-background dark:border-dark-tremor-border dark:divide-dark-tremor-border dark:shadow-dark-tremor-dropdown",b.twoXs.marginTop,b.twoXs.marginBottom,u.sm.all)},o.createElement(E,Object.assign({mode:"range",showOutsideDays:!0,defaultMonth:me,selected:{from:le,to:de},onSelect:e=>{null==V||V({from:null==e?void 0:e.from,to:null==e?void 0:e.to}),W({from:null==e?void 0:e.from,to:null==e?void 0:e.to})},locale:Y,disabled:te,enableYearNavigation:G,classNames:{day_range_middle:f("!rounded-none aria-selected:!bg-tremor-background-subtle aria-selected:dark:!bg-dark-tremor-background-subtle aria-selected:!text-tremor-content aria-selected:dark:!bg-dark-tremor-background-subtle"),day_range_start:"rounded-r-none rounded-l-tremor-small aria-selected:text-tremor-brand-inverted dark:aria-selected:text-dark-tremor-brand-inverted",day_range_end:"rounded-l-none rounded-r-tremor-small aria-selected:text-tremor-brand-inverted dark:aria-selected:text-dark-tremor-brand-inverted"},weekStartsOn:H},m))))),B&&o.createElement(a,{as:"div",className:f("w-48 -ml-px rounded-r-tremor-default",ee&&"ring-2 ring-tremor-brand-muted dark:ring-dark-tremor-brand-muted z-10"),value:ne,onChange:e=>{const{from:r,to:t}=ae.get(e),a=null!=t?t:X;null==V||V({from:r,to:a,selectValue:e}),W({from:r,to:a,selectValue:e})},disabled:P},(({value:e})=>{var r;return o.createElement(o.Fragment,null,o.createElement(a.Button,{onFocus:()=>re(!0),onBlur:()=>re(!1),className:f("w-full outline-none text-left whitespace-nowrap truncate rounded-r-tremor-default transition duration-100","border-tremor-border shadow-tremor-input text-tremor-content-emphasis focus:border-tremor-brand-subtle","dark:border-dark-tremor-border dark:shadow-dark-tremor-input dark:text-dark-tremor-content-emphasis dark:focus:border-dark-tremor-brand-subtle",b.twoXl.paddingLeft,b.twoXl.paddingRight,b.sm.paddingY,u.sm.all,k(v(e),P))},e&&null!==(r=oe.get(e))&&void 0!==r?r:M),o.createElement(t,{className:"absolute z-10 w-full inset-x-0 right-0",enter:"transition ease duration-100 transform",enterFrom:"opacity-0 -translate-y-4",enterTo:"opacity-100 translate-y-0",leave:"transition ease duration-100 transform",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 -translate-y-4"},o.createElement(a.Options,{className:f("divide-y overflow-y-auto outline-none","shadow-tremor-dropdown bg-tremor-background border-tremor-border divide-tremor-border rounded-tremor-default","dark:shadow-dark-tremor-dropdown dark:bg-dark-tremor-background dark:border-dark-tremor-border dark:divide-dark-tremor-border",b.twoXs.marginTop,b.twoXs.marginBottom,u.sm.all)},null!=q?q:h.map((e=>o.createElement(j,{key:e.value,value:e.value},e.text))))))})))}));D.displayName="DateRangePicker";export{D as default};
