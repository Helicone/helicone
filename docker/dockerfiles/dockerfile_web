FROM node:18.18.0

COPY ./package.json /app/web/package.json
COPY ./yarn.lock /app/web/yarn.lock

WORKDIR /app/web

RUN yarn

# Exclude yarn.lock from the copy command to avoid unnecessary rebuilds
COPY . /app/web
COPY ./yarn.lock /app/web/yarn.lock


RUN rm .env.* || true

EXPOSE 3000

CMD ["yarn", "build-and-start"]