FROM --platform=linux/amd64 node:18.18.0

WORKDIR /app
RUN apt update -y
RUN apt install curl git -y
# Install gcc
RUN apt install build-essential -y

COPY . /app/supabase

WORKDIR /app

RUN npm i supabase

# CMD sh -c "npx supabase db push --db-url ${DATABASE_URL} && python3 clickhouse/ch_hcone.py --upgrade --host ${CLICKHOUSE_HOST_DOCKER} --port ${CLICKHOUSE_PORT} && yarn build-and-start"
CMD sh -c "cd supabase && npx supabase db push --db-url ${DATABASE_URL}"
