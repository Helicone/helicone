var A=Object.defineProperty,z=Object.defineProperties,P=Object.getOwnPropertyDescriptor,L=Object.getOwnPropertyDescriptors,U=Object.getOwnPropertyNames,R=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var H=(s,e,n)=>e in s?A(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,$=(s,e)=>{for(var n in e||(e={}))O.call(e,n)&&H(s,n,e[n]);if(R)for(var n of R(e))X.call(e,n)&&H(s,n,e[n]);return s},W=(s,e)=>z(s,L(e));var _=(s,e)=>{for(var n in e)A(s,n,{get:e[n],enumerable:!0})},j=(s,e,n,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of U(e))!O.call(s,r)&&r!==n&&A(s,r,{get:()=>e[r],enumerable:!(t=P(e,r))||t.enumerable});return s};var B=s=>j(A({},"__esModule",{value:!0}),s);var F=(s,e,n)=>{if(!e.has(s))throw TypeError("Cannot "+n)};var f=(s,e,n)=>(F(s,e,"read from private field"),n?n.call(s):e.get(s)),v=(s,e,n)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,n)},p=(s,e,n,t)=>(F(s,e,"write to private field"),t?t.call(s,n):e.set(s,n),n);var ee={};_(ee,{Cron:()=>D,IntervalBasedCronScheduler:()=>N,TIMEOUT_MAX:()=>te,TimerBasedCronScheduler:()=>S,extractDateElements:()=>k,getDaysBetweenWeekdays:()=>M,getDaysInMonth:()=>C,longTimeout:()=>E,parseCronExpression:()=>V,wrapFunction:()=>g});module.exports=B(ee);var te=2147483647;function E(s,e,n){let t=0;return e>2147483647&&(t=e-2147483647,e=2147483647),n!=null||(n={timeoutId:void 0}),n.timeoutId=setTimeout(()=>{t>0?E(s,t,n):s()},e),n}function k(s){return{second:s.getSeconds(),minute:s.getMinutes(),hour:s.getHours(),day:s.getDate(),month:s.getMonth(),weekday:s.getDay(),year:s.getFullYear()}}function C(s,e){return new Date(s,e+1,0).getDate()}function M(s,e){return s<=e?e-s:6-s+e+1}function g(s,e){return()=>{try{let n=s();n instanceof Promise&&n.catch(t=>{e&&e(t)})}catch(n){e&&e(n)}}}var I,y,c,T,N=class{constructor(e){v(this,I,void 0);v(this,y,void 0);v(this,c,[]);v(this,T,1);p(this,I,e),this.start()}start(){if(f(this,y)!==void 0)throw new Error("Scheduler already started.");p(this,y,setInterval(this.processTasks.bind(this),f(this,I)))}stop(){f(this,y)&&(clearInterval(f(this,y)),p(this,y,void 0))}insertTask(e){let n=f(this,c).findIndex(t=>t.nextExecution.getTime()>e.nextExecution.getTime());f(this,c).splice(n,0,e)}registerTask(e,n,t){var o;let r=f(this,T);return this.insertTask({id:r,cron:e,nextExecution:e.getNextDate(),task:n,isOneTimeTask:(o=t==null?void 0:t.isOneTimeTask)!=null?o:!1,errorHandler:t==null?void 0:t.errorHandler}),p(this,T,f(this,T)+1),r}unregisterTask(e){let n=f(this,c).findIndex(t=>t.id===e);if(n===-1)throw new Error("Task not found.");f(this,c).splice(n,1)}sortTasks(){f(this,c).sort((e,n)=>e.nextExecution.getTime()-n.nextExecution.getTime())}processTasks(){let e=Date.now(),n=!1,t=!1;for(let r=0;r<f(this,c).length;r+=1){let o=f(this,c)[r];if(o.nextExecution.getTime()<=e)g(o.task,o.errorHandler)(),o.isOneTimeTask?t=!0:(n=!0,o.nextExecution=o.cron.getNextDate());else break}t&&p(this,c,f(this,c).filter(r=>r.nextExecution.getTime()>e)),n&&this.sortTasks()}};I=new WeakMap,y=new WeakMap,c=new WeakMap,T=new WeakMap;var S=class{static setTimeout(e,n,t){let o=e.getNextDate().getTime()-Date.now();return E(g(n,t==null?void 0:t.errorHandler),o)}static setInterval(e,n,t){var u;let r=(u=t==null?void 0:t.handle)!=null?u:{timeoutId:void 0},{timeoutId:o}=this.setTimeout(e,()=>{g(n,t==null?void 0:t.errorHandler)(),this.setInterval(e,n,W($({},t),{handle:r}))});return r.timeoutId=o,r}static clearTimeoutOrInterval(e){e.timeoutId&&clearTimeout(e.timeoutId)}};var D=class{constructor({seconds:e,minutes:n,hours:t,days:r,months:o,weekdays:u}){if(!e||e.size===0)throw new Error("There must be at least one allowed second.");if(!n||n.size===0)throw new Error("There must be at least one allowed minute.");if(!t||t.size===0)throw new Error("There must be at least one allowed hour.");if(!o||o.size===0)throw new Error("There must be at least one allowed month.");if((!u||u.size===0)&&(!r||r.size===0))throw new Error("There must be at least one allowed day or weekday.");this.seconds=Array.from(e).sort((i,d)=>i-d),this.minutes=Array.from(n).sort((i,d)=>i-d),this.hours=Array.from(t).sort((i,d)=>i-d),this.days=Array.from(r).sort((i,d)=>i-d),this.months=Array.from(o).sort((i,d)=>i-d),this.weekdays=Array.from(u).sort((i,d)=>i-d);let m=(i,d,a)=>{if(d.some(l=>typeof l!="number"||l%1!==0||l<a.min||l>a.max))throw new Error(`${i} must only consist of integers which are within the range of ${a.min} and ${a.max}`)};m("seconds",this.seconds,{min:0,max:59}),m("minutes",this.minutes,{min:0,max:59}),m("hours",this.hours,{min:0,max:23}),m("days",this.days,{min:1,max:31}),m("months",this.months,{min:0,max:11}),m("weekdays",this.weekdays,{min:0,max:6}),this.reversed={seconds:this.seconds.map(i=>i).reverse(),minutes:this.minutes.map(i=>i).reverse(),hours:this.hours.map(i=>i).reverse(),days:this.days.map(i=>i).reverse(),months:this.months.map(i=>i).reverse(),weekdays:this.weekdays.map(i=>i).reverse()}}findAllowedHour(e,n){return e==="next"?this.hours.find(t=>t>=n):this.reversed.hours.find(t=>t<=n)}findAllowedMinute(e,n){return e==="next"?this.minutes.find(t=>t>=n):this.reversed.minutes.find(t=>t<=n)}findAllowedSecond(e,n){return e==="next"?this.seconds.find(t=>t>n):this.reversed.seconds.find(t=>t<n)}findAllowedTime(e,n){let t=this.findAllowedHour(e,n.hour);if(t!==void 0)if(t===n.hour){let r=this.findAllowedMinute(e,n.minute);if(r!==void 0)if(r===n.minute){let o=this.findAllowedSecond(e,n.second);if(o!==void 0)return{hour:t,minute:r,second:o};if(r=this.findAllowedMinute(e,e==="next"?n.minute+1:n.minute-1),r!==void 0)return{hour:t,minute:r,second:e==="next"?this.seconds[0]:this.reversed.seconds[0]}}else return{hour:t,minute:r,second:e==="next"?this.seconds[0]:this.reversed.seconds[0]};if(t=this.findAllowedHour(e,e==="next"?n.hour+1:n.hour-1),t!==void 0)return{hour:t,minute:e==="next"?this.minutes[0]:this.reversed.minutes[0],second:e==="next"?this.seconds[0]:this.reversed.seconds[0]}}else return{hour:t,minute:e==="next"?this.minutes[0]:this.reversed.minutes[0],second:e==="next"?this.seconds[0]:this.reversed.seconds[0]}}findAllowedDayInMonth(e,n,t,r){var a,l;if(r<1)throw new Error("startDay must not be smaller than 1.");let o=C(n,t),u=this.days.length!==31,m=this.weekdays.length!==7;if(!u&&!m)return r>o?e==="next"?void 0:o:r;let i;u&&(i=e==="next"?this.days.find(h=>h>=r):this.reversed.days.find(h=>h<=r),i!==void 0&&i>o&&(i=void 0));let d;if(m){let h=new Date(n,t,r).getDay(),x=e==="next"?(a=this.weekdays.find(b=>b>=h))!=null?a:this.weekdays[0]:(l=this.reversed.weekdays.find(b=>b<=h))!=null?l:this.reversed.weekdays[0];if(x!==void 0){let b=e==="next"?M(h,x):M(x,h);d=e==="next"?r+b:r-b,(d>o||d<1)&&(d=void 0)}}if(i!==void 0&&d!==void 0)return e==="next"?Math.min(i,d):Math.max(i,d);if(i!==void 0)return i;if(d!==void 0)return d}getNextDate(e=new Date){let n=k(e),t=n.year,r=this.months.findIndex(u=>u>=n.month);r===-1&&(r=0,t++);let o=this.months.length*5;for(let u=0;u<o;u++){let m=t+Math.floor((r+u)/this.months.length),i=this.months[(r+u)%this.months.length],d=m===n.year&&i===n.month,a=this.findAllowedDayInMonth("next",m,i,d?n.day:1),l=d&&a===n.day;if(a!==void 0&&l){let h=this.findAllowedTime("next",n);if(h!==void 0)return new Date(m,i,a,h.hour,h.minute,h.second);a=this.findAllowedDayInMonth("next",m,i,a+1),l=!1}if(a!==void 0&&!l)return new Date(m,i,a,this.hours[0],this.minutes[0],this.seconds[0])}throw new Error("No valid next date was found.")}getNextDates(e,n){let t=[],r;for(let o=0;o<e;o++)r=this.getNextDate(r!=null?r:n),t.push(r);return t}*getNextDatesIterator(e,n){let t;for(;;){if(t=this.getNextDate(e),e=t,n&&n.getTime()<t.getTime())return;yield t}}getPrevDate(e=new Date){let n=k(e),t=n.year,r=this.reversed.months.findIndex(u=>u<=n.month);r===-1&&(r=0,t--);let o=this.reversed.months.length*5;for(let u=0;u<o;u++){let m=t-Math.floor((r+u)/this.reversed.months.length),i=this.reversed.months[(r+u)%this.reversed.months.length],d=m===n.year&&i===n.month,a=this.findAllowedDayInMonth("prev",m,i,d?n.day:31),l=d&&a===n.day;if(a!==void 0&&l){let h=this.findAllowedTime("prev",n);if(h!==void 0)return new Date(m,i,a,h.hour,h.minute,h.second);a>1&&(a=this.findAllowedDayInMonth("prev",m,i,a-1),l=!1)}if(a!==void 0&&!l)return new Date(m,i,a,this.reversed.hours[0],this.reversed.minutes[0],this.reversed.seconds[0])}throw new Error("No valid previous date was found.")}getPrevDates(e,n){let t=[],r;for(let o=0;o<e;o++)r=this.getPrevDate(r!=null?r:n),t.push(r);return t}*getPrevDatesIterator(e,n){let t;for(;;){if(t=this.getPrevDate(e),e=t,n&&n.getTime()>t.getTime())return;yield t}}matchDate(e){let{second:n,minute:t,hour:r,day:o,month:u,weekday:m}=k(e);return this.seconds.indexOf(n)===-1||this.minutes.indexOf(t)===-1||this.hours.indexOf(r)===-1||this.months.indexOf(u)===-1?!1:this.days.length!==31&&this.weekdays.length!==7?this.days.indexOf(o)!==-1||this.weekdays.indexOf(m)!==-1:this.days.indexOf(o)!==-1&&this.weekdays.indexOf(m)!==-1}};var Y={min:0,max:59},G={min:0,max:59},Z={min:0,max:23},q={min:1,max:31},J={min:1,max:12,aliases:{jan:"1",feb:"2",mar:"3",apr:"4",may:"5",jun:"6",jul:"7",aug:"8",sep:"9",oct:"10",nov:"11",dec:"12"}},K={min:0,max:6,aliases:{"7":"0",sun:"0",mon:"1",tue:"2",wed:"3",thu:"4",fri:"5",sat:"6"}},Q={"@yearly":"0 0 1 1 *","@annually":"0 0 1 1 *","@monthly":"0 0 1 1 *","@weekly":"0 0 * * 0","@daily":"0 0 * * *","@hourly":"0 * * * *","@minutely":"* * * * *"};function w(s,e){let n=new Set;if(s==="*"){for(let a=e.min;a<=e.max;a=a+1)n.add(a);return n}let t=s.split(",");if(t.length>1)return t.forEach(a=>{w(a,e).forEach(h=>n.add(h))}),n;let r=a=>{var h,x;a=(x=(h=e.aliases)==null?void 0:h[a.toLowerCase()])!=null?x:a;let l=parseInt(a,10);if(Number.isNaN(l))throw new Error(`Failed to parse ${s}: ${a} is NaN.`);if(l<e.min||l>e.max)throw new Error(`Failed to parse ${s}: ${a} is outside of constraint range of ${e.min} - ${e.max}.`);return l},o=/^((([0-9a-zA-Z]+)-([0-9a-zA-Z]+))|\*)(\/([0-9]+))?$/.exec(s);if(o===null)return n.add(r(s)),n;let u=o[1]==="*"?e.min:r(o[3]),m=o[1]==="*"?e.max:r(o[4]);if(u>m)throw new Error(`Failed to parse ${s}: Invalid range (start: ${u}, end: ${m}).`);let i=o[6],d=1;if(i!==void 0){if(d=parseInt(i,10),Number.isNaN(d))throw new Error(`Failed to parse step: ${i} is NaN.`);if(d<1)throw new Error(`Failed to parse step: Expected ${i} to be greater than 0.`)}for(let a=u;a<=m;a=a+d)n.add(a);return n}function V(s){var i;if(typeof s!="string")throw new TypeError("Invalid cron expression: must be of type string.");s=(i=Q[s.toLowerCase()])!=null?i:s;let e=s.split(" ");if(e.length<5||e.length>6)throw new Error("Invalid cron expression: expected 5 or 6 elements.");let n=e.length===6?e[0]:"0",t=e.length===6?e[1]:e[0],r=e.length===6?e[2]:e[1],o=e.length===6?e[3]:e[2],u=e.length===6?e[4]:e[3],m=e.length===6?e[5]:e[4];return new D({seconds:w(n,Y),minutes:w(t,G),hours:w(r,Z),days:w(o,q),months:new Set(Array.from(w(u,J)).map(d=>d-1)),weekdays:w(m,K)})}0&&(module.exports={Cron,IntervalBasedCronScheduler,TIMEOUT_MAX,TimerBasedCronScheduler,extractDateElements,getDaysBetweenWeekdays,getDaysInMonth,longTimeout,parseCronExpression,wrapFunction});
//# sourceMappingURL=cron-schedule.cjs.min.js.map
